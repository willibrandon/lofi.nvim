{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Generate Method Contract",
  "description": "JSON-RPC contract for music generation requests",

  "definitions": {
    "GenerateRequest": {
      "type": "object",
      "properties": {
        "jsonrpc": { "const": "2.0" },
        "method": { "const": "generate" },
        "id": { "type": ["integer", "string"] },
        "params": {
          "type": "object",
          "properties": {
            "prompt": {
              "type": "string",
              "minLength": 1,
              "maxLength": 1000,
              "description": "Text description of desired music"
            },
            "duration_sec": {
              "type": "integer",
              "minimum": 5,
              "maximum": 120,
              "default": 30,
              "description": "Duration of audio to generate in seconds"
            },
            "seed": {
              "type": ["integer", "null"],
              "minimum": 0,
              "description": "Random seed for reproducibility; null for random"
            },
            "priority": {
              "type": "string",
              "enum": ["normal", "high"],
              "default": "normal",
              "description": "Queue priority; high skips to front"
            }
          },
          "required": ["prompt"],
          "additionalProperties": false
        }
      },
      "required": ["jsonrpc", "method", "id", "params"]
    },

    "GenerateResponse": {
      "type": "object",
      "properties": {
        "jsonrpc": { "const": "2.0" },
        "id": { "type": ["integer", "string"] },
        "result": {
          "type": "object",
          "properties": {
            "track_id": {
              "type": "string",
              "pattern": "^[a-f0-9]{16}$",
              "description": "Unique identifier for this generation"
            },
            "status": {
              "type": "string",
              "enum": ["queued", "generating"],
              "description": "Initial status after request"
            },
            "position": {
              "type": "integer",
              "minimum": 0,
              "maximum": 9,
              "description": "Queue position (0 = next to generate)"
            },
            "seed": {
              "type": "integer",
              "minimum": 0,
              "description": "Seed that will be used (useful when input was null)"
            }
          },
          "required": ["track_id", "status", "position", "seed"],
          "additionalProperties": false
        }
      },
      "required": ["jsonrpc", "id", "result"]
    }
  },

  "examples": {
    "request": {
      "jsonrpc": "2.0",
      "method": "generate",
      "id": 1,
      "params": {
        "prompt": "lofi hip hop, jazzy piano, relaxing vibes",
        "duration_sec": 30,
        "seed": null,
        "priority": "normal"
      }
    },
    "response": {
      "jsonrpc": "2.0",
      "id": 1,
      "result": {
        "track_id": "a1b2c3d4e5f67890",
        "status": "queued",
        "position": 0,
        "seed": 1234567890
      }
    }
  }
}
